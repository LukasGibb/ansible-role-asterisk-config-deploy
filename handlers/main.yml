---
# handlers file for ansible-role-asterisk-config-deploy

- name: asterisk find repo base files
  find:
    paths: "{{ asterisk_config_deploy_base_path }}"
    patterns: "*.conf,*.ael,*.adsi,*.lua"
  register: find_base

- name: asterisk symlink repo base files
  file:
    src: "{{ asterisk_config_deploy_base_path }}{{ item.path | basename }}"
    dest: "{{ asterisk_config_deploy_asterisk_path }}{{ item.path | basename }}"
    state: link
    force: yes
  with_items: "{{ find_base.files }}"
  notify: asterisk reload

- name: asterisk find repo override files
  find:
    paths: "{{ asterisk_config_deploy_or_path }}"
    patterns: "*.conf,*.ael,*.adsi,*.lua"
  register: find_override

- name: asterisk symlink repo override files
  file:
    src: "{{ asterisk_config_deploy_or_path }}{{ item.path | basename }}"
    dest: "{{ asterisk_config_deploy_asterisk_path }}{{ item.path | basename }}"
    state: link
    force: yes
  with_items: "{{ find_override.files }}"
  notify: asterisk reload

- name: asterisk check repo sounds directory
  stat:
    path: "{{ asterisk_config_deploy_path }}{{ asterisk_config_deploy_sounds_dir }}"
  register: sounds_dir

- name: asterisk symlink repo sounds directory
  file:
    src: "{{ asterisk_config_deploy_path }}{{ asterisk_config_deploy_sounds_dir }}"
    dest: "{{ asterisk_config_deploy_sounds_path }}"
    state: link
    force: yes
  when: sounds_dir.stat.isdir is defined and sounds_dir.stat.isdir

- name: asterisk check repo moh directory
  stat:
    path: "{{ asterisk_config_deploy_path }}{{ asterisk_config_deploy_moh_dir }}"
  register: moh_dir

- name: asterisk symlink repo moh directory
  file:
    src: "{{ asterisk_config_deploy_path }}{{ asterisk_config_deploy_moh_dir }}"
    dest: "{{ asterisk_config_deploy_moh_path }}"
    state: link
    force: yes
  when: moh_dir.stat.isdir is defined and moh_dir.stat.isdir

- name: asterisk reload
  service: name=asterisk state=restarted
